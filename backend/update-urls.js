// MongoDB'deki localhost URL'lerini production URL'lere g√ºncelle
require('dotenv').config();
const mongoose = require('mongoose');
const Profile = require('./models/Profile');
const Project = require('./models/Project');

const BACKEND_URL = 'https://portfolioproject-gigt.onrender.com';

async function updateUrls() {
    try {
        await mongoose.connect(process.env.MONGODB_URI);
        console.log('MongoDB baƒülantƒ±sƒ± ba≈üarƒ±lƒ±');

        // Profile URL'lerini g√ºncelle
        const profile = await Profile.findOne();
        if (profile) {
            if (profile.avatarUrl) {
                profile.avatarUrl = profile.avatarUrl.replace(/http:\/\/localhost:\d+/, BACKEND_URL);
            }
            if (profile.cvUrl) {
                profile.cvUrl = profile.cvUrl.replace(/http:\/\/localhost:\d+/, BACKEND_URL);
            }
            
            // Tech stack iconlarƒ±nƒ± g√ºncelle
            if (profile.techStack) {
                profile.techStack.forEach(tech => {
                    if (tech.icon && tech.icon.startsWith('custom:http://localhost')) {
                        tech.icon = tech.icon.replace(/http:\/\/localhost:\d+/, BACKEND_URL);
                    }
                });
            }
            
            await profile.save();
            console.log('‚úÖ Profile URL\'leri g√ºncellendi');
        }

        // Project URL'lerini g√ºncelle
        const projects = await Project.find();
        for (const project of projects) {
            if (project.imageUrl) {
                project.imageUrl = project.imageUrl.replace(/http:\/\/localhost:\d+/, BACKEND_URL);
            }
            await project.save();
        }
        console.log(`‚úÖ ${projects.length} proje URL'leri g√ºncellendi`);

        console.log('\nüéâ T√ºm URL\'ler ba≈üarƒ±yla g√ºncellendi!');
        process.exit(0);
    } catch (error) {
        console.error('‚ùå Hata:', error);
        process.exit(1);
    }
}

updateUrls();
